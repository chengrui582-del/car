<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>真實車輛儀表</title>
<style>
body{
  margin:0;
  background:#111;
  color:#fff;
  font-family:sans-serif;
  display:flex;
  flex-direction:column;
  align-items:center;
}
#gauge{
  position:relative;
  width:90vw;
  max-width:400px;
  height:90vw;
  max-height:400px;
}
canvas{position:absolute}
.controls{
  margin-top:10px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:center;
}
.btn{
  width:80px;
  height:55px;
  background:#222;
  border-radius:10px;
  text-align:center;
  line-height:55px;
  user-select:none;
}
.data{
  margin-top:5px;
  font-size:15px;
}
</style>
</head>
<body>

<div id="gauge">
  <canvas id="dial" width="400" height="400"></canvas>
  <canvas id="needle" width="400" height="400"></canvas>
  <canvas id="hpDot" width="400" height="400"></canvas>
</div>

<div class="controls">
  <div class="btn" id="keyBtn">KEY</div>
  <div class="btn" id="throttle">油門</div>
  <div class="btn" id="brake">煞車</div>
</div>

<div class="controls">
  <div class="btn" onclick="setGear(1)">1</div>
  <div class="btn" onclick="setGear(2)">2</div>
  <div class="btn" onclick="setGear(3)">3</div>
  <div class="btn" onclick="setGear(4)">4</div>
  <div class="btn" onclick="setGear(5)">5</div>
  <div class="btn" onclick="setGear(6)">6</div>
</div>

<div class="data">
  狀態:<span id="state">OFF</span> |
  檔位:<span id="gear">1</span> |
  RPM:<span id="rpm">0</span> |
  HP:<span id="hp">0</span> |
  速度:<span id="speed">0</span> km/h |
  燃油:<span id="fuel">100</span>%
</div>

<script>
const dial=document.getElementById("dial").getContext("2d");
const needle=document.getElementById("needle").getContext("2d");
const hpDot=document.getElementById("hpDot").getContext("2d");

let key=false, throttle=false, brake=false;
let rpm=0, gear=1, speed=0, fuel=100;

const maxRPM=9000;
const gearRatio=[0,3.5,2.2,1.6,1.2,1.0,0.8];
const finalDrive=3.9;
const wheel=2.0;

function drawDial(){
  dial.clearRect(0,0,400,400);
  dial.fillStyle="#222";
  dial.beginPath();
  dial.arc(200,200,180,0,Math.PI*2);
  dial.fill();
}
function drawNeedle(){
  needle.clearRect(0,0,400,400);
  let a=Math.PI*0.75+rpm/maxRPM*Math.PI*1.5;
  needle.beginPath();
  needle.moveTo(200,200);
  needle.lineTo(200+Math.cos(a)*150,200+Math.sin(a)*150);
  needle.strokeStyle="red";
  needle.lineWidth=4;
  needle.stroke();
}
function drawHP(){
  hpDot.clearRect(0,0,400,400);
  let torque=200*Math.sin(Math.PI*rpm/maxRPM)+100;
  let hp=torque*rpm/712.5;
  let a=Math.PI*0.75+rpm/maxRPM*Math.PI*1.5;
  let r=100+hp/500*60;
  hpDot.beginPath();
  hpDot.arc(200+Math.cos(a)*r,200+Math.sin(a)*r,6,0,Math.PI*2);
  hpDot.fillStyle="yellow";
  hpDot.fill();
  document.getElementById("hp").textContent=Math.floor(hp);
}

function update(){
  if(key && fuel>0){
    if(throttle) rpm+=120*gear;
    if(brake) rpm-=400;
    rpm-=60;
    fuel-=throttle?rpm*0.000002:0.0003;
  } else rpm-=100;

  rpm=Math.max(0,Math.min(maxRPM,rpm));
  fuel=Math.max(0,fuel);

  speed=(rpm/(gearRatio[gear]*finalDrive))*wheel*60/1000;

  document.getElementById("rpm").textContent=Math.floor(rpm);
  document.getElementById("speed").textContent=Math.floor(speed);
  document.getElementById("fuel").textContent=fuel.toFixed(1);

  drawNeedle();
  drawHP();
  requestAnimationFrame(update);
}

function setGear(g){gear=g;document.getElementById("gear").textContent=g;}

document.getElementById("keyBtn").onclick=()=>{
  key=!key;
  document.getElementById("state").textContent=key?"ON":"OFF";
};

["mousedown","touchstart"].forEach(e=>{
  throttle.addEventListener(e,()=>throttle=true);
  brake.addEventListener(e,()=>brake=true);
});
["mouseup","touchend","mouseleave"].forEach(e=>{
  throttle.addEventListener(e,()=>throttle=false);
  brake.addEventListener(e,()=>brake=false);
});

document.addEventListener("keydown",e=>{
  if(e.key==="w") throttle=true;
  if(e.key==="s") brake=true;
  if(e.key==="e") document.getElementById("keyBtn").click();
  if(e.key>="1"&&e.key<="6") setGear(+e.key);
});
document.addEventListener("keyup",e=>{
  if(e.key==="w") throttle=false;
  if(e.key==="s") brake=false;
});

drawDial();
update();
</script>
</body>
</html>
