<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>手機版真實馬力表</title>
<style>
  body {
    margin: 0;
    background: #111;
    color: #fff;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    height: 100vh;
    font-family: sans-serif;
    touch-action: none;
  }
  #gauge-container {
    position: relative;
    width: 90vw;
    max-width: 400px;
    height: 90vw;
    max-height: 400px;
  }
  canvas {
    position: absolute;
    top: 0;
    left: 0;
  }
  #controls {
    margin-top: 20px;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 10px;
  }
  .button {
    width: 80px;
    height: 60px;
    background: #222;
    border-radius: 10px;
    font-size: 20px;
    color: #fff;
    text-align: center;
    line-height: 60px;
    user-select: none;
  }
  .gear-buttons {
    display: flex;
    gap: 10px;
  }
</style>
</head>
<body>

<div id="gauge-container">
  <canvas id="dial" width="400" height="400"></canvas>
  <canvas id="needle" width="400" height="400"></canvas>
  <canvas id="powerCurve" width="400" height="400"></canvas>
</div>

<div id="controls">
  <div id="throttle" class="button">油門</div>
  <div class="gear-buttons">
    <div class="button" onclick="changeGear(1)">1</div>
    <div class="button" onclick="changeGear(2)">2</div>
    <div class="button" onclick="changeGear(3)">3</div>
    <div class="button" onclick="changeGear(4)">4</div>
    <div class="button" onclick="changeGear(5)">5</div>
    <div class="button" onclick="changeGear(6)">6</div>
  </div>
  <div>檔位: <span id="gearDisplay">1</span></div>
  <div>RPM: <span id="rpmDisplay">1000</span>  HP: <span id="hpDisplay">0</span></div>
</div>

<script>
const dialCanvas = document.getElementById('dial');
const needleCanvas = document.getElementById('needle');
const curveCanvas = document.getElementById('powerCurve');
const dialCtx = dialCanvas.getContext('2d');
const needleCtx = needleCanvas.getContext('2d');
const curveCtx = curveCanvas.getContext('2d');

const rpmDisplay = document.getElementById('rpmDisplay');
const hpDisplay = document.getElementById('hpDisplay');
const gearDisplay = document.getElementById('gearDisplay');

const maxRPM = 9000;
const redline = 7000;
let currentRPM = 1000;
let throttle = false;
let gear = 1;

// 模擬扭力曲線 (Nm)
const torqueCurve = [];
for(let rpm=0; rpm<=maxRPM; rpm+=100){
  let torque = 200 * Math.sin(Math.PI * rpm / maxRPM) + 100; 
  torqueCurve.push({rpm, torque});
}

// 畫圓形表盤
function drawDial(){
  dialCtx.clearRect(0,0,400,400);
  const centerX = 200, centerY = 200, radius = 180;

  dialCtx.beginPath();
  dialCtx.arc(centerX, centerY, radius, 0, 2*Math.PI);
  dialCtx.fillStyle = '#222';
  dialCtx.fill();

  for(let i=0;i<=maxRPM;i+=1000){
    let angle = Math.PI*0.75 + i/maxRPM * (Math.PI*1.5);
    let x1 = centerX + Math.cos(angle)*radius;
    let y1 = centerY + Math.sin(angle)*radius;
    let x2 = centerX + Math.cos(angle)*(radius-15);
    let y2 = centerY + Math.sin(angle)*(radius-15);

    dialCtx.beginPath();
    dialCtx.moveTo(x1,y1);
    dialCtx.lineTo(x2,y2);
    dialCtx.strokeStyle = '#fff';
    dialCtx.lineWidth = 2;
    dialCtx.stroke();

    let textX = centerX + Math.cos(angle)*(radius-30);
    let textY = centerY + Math.sin(angle)*(radius-30);
    dialCtx.fillStyle = '#fff';
    dialCtx.font = '16px sans-serif';
    dialCtx.textAlign = 'center';
    dialCtx.textBaseline = 'middle';
    dialCtx.fillText(i, textX, textY);
  }

  let redAngle = Math.PI*0.75 + redline/maxRPM * (Math.PI*1.5);
  dialCtx.beginPath();
  dialCtx.arc(centerX, centerY, radius-10, redAngle-0.01, redAngle+0.01);
  dialCtx.strokeStyle = 'red';
  dialCtx.lineWidth = 4;
  dialCtx.stroke();
}

// 畫指針
function drawNeedle(rpm){
  needleCtx.clearRect(0,0,400,400);
  const centerX = 200, centerY = 200, radius = 160;
  let angle = Math.PI*0.75 + rpm/maxRPM * (Math.PI*1.5);

  needleCtx.beginPath();
  needleCtx.moveTo(centerX, centerY);
  needleCtx.lineTo(centerX + Math.cos(angle)*radius, centerY + Math.sin(angle)*radius);
  needleCtx.strokeStyle = 'red';
  needleCtx.lineWidth = 4;
  needleCtx.stroke();

  needleCtx.beginPath();
  needleCtx.arc(centerX, centerY, 10, 0, 2*Math.PI);
  needleCtx.fillStyle = '#fff';
  needleCtx.fill();
}

// 畫馬力曲線
function drawPowerCurve(){
  curveCtx.clearRect(0,0,400,400);
  const centerX = 200, centerY = 200, radius = 150;

  curveCtx.beginPath();
  for(let i=0;i<torqueCurve.length;i++){
    let rpm = torqueCurve[i].rpm;
    let torque = torqueCurve[i].torque;
    let hp = torque * rpm / 712.5; 
    let angle = Math.PI*0.75 + rpm/maxRPM * (Math.PI*1.5);
    let len = radius * hp/500; 
    let x = centerX + Math.cos(angle)*len;
    let y = centerY + Math.sin(angle)*len;

    if(i===0) curveCtx.moveTo(x,y);
    else curveCtx.lineTo(x,y);
  }
  curveCtx.strokeStyle = '#0f0';
  curveCtx.lineWidth = 2;
  curveCtx.stroke();
}

// 改變檔位
function changeGear(g){
  gear = g;
  gearDisplay.textContent = gear;
}

// 更新RPM與HP
function updateValues(){
  let rpmIncrease = throttle ? 200*gear : -150; // 檔位影響加速
  currentRPM += rpmIncrease * 0.05;
  currentRPM = Math.max(0, Math.min(maxRPM, currentRPM));

  // 計算當前HP
  let torque = torqueCurve[Math.floor(currentRPM/100)]?.torque || 100;
  let hp = torque * currentRPM / 712.5; 

  rpmDisplay.textContent = Math.floor(currentRPM);
  hpDisplay.textContent = Math.floor(hp);

  drawNeedle(currentRPM);
}

// 油門觸控事件
const throttleBtn = document.getElementById('throttle');
throttleBtn.addEventListener('touchstart',()=>{ throttle=true; });
throttleBtn.addEventListener('touchend',()=>{ throttle=false; });
throttleBtn.addEventListener('mousedown',()=>{ throttle=true; });
throttleBtn.addEventListener('mouseup',()=>{ throttle=false; });
throttleBtn.addEventListener('mouseleave',()=>{ throttle=false; });

// 動畫循環
drawDial();
drawPowerCurve();
function loop(){
  updateValues();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
